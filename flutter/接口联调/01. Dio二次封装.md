# Dio二次封装拦截器配置&接口统一管理

## Dio二次封装拦截器配置

```dart
// dio 二次封装
import 'package:dio/dio.dart';
import "package:get/get.dart";
class HttpsClient{
  static String baseUrl = "URL";
  static Dio dio = Dio();
  HttpsClient(){
    dio.options.baseUrl = baseUrl;
    dio.options.connectTimeout = const Duration(seconds: 5); // 连接超时 5s
    dio.options.receiveTimeout = const Duration(seconds: 5); // 接受超时 5s
    dio.interceptors.add(CustomInterceptors()); // dio 拦截器
  }
  // 封装Get请求方式, 其他请求方式见dio官网文档
  Future get(apiUrl,[queryParameters]) async {
    try {
      var response = await dio.get(apiUrl,queryParameters:queryParameters);
      return response;
    } catch (e) {
      print("请求超时");
      return null;
    }
  }
}
// 定义拦截器类
class CustomInterceptors extends Interceptor {
  // 请求拦截器
  @override
  void onRequest(RequestOptions options, RequestInterceptorHandler handler) {
    // 检查是否登录
    final isAuthenticated = checkIfAuthenticated();
    if (options.path != "/login") {
      // 添加 token
      final token = getToken();
      options.headers['Authorization'] = 'Bearer token';
    }
    // print('REQUEST[${options.method}] => PATH: ${options.path}');
    super.onRequest(options, handler);
  }
  // 响应拦截器
  @override
  void onResponse(dynamic response, ResponseInterceptorHandler handler) {
    // print('RESPONSE[${response.statusCode}] => PATH: ${response.requestOptions.path}');
    super.onResponse(response, handler);
    if (response.statusCode == 401) { // token失效或用户未登录
      // 跳转到登录页面
      // Navigator.pushNamedAndRemoveUntil(context, '/login', (_) => false);
      Get.offAllNamed("/login"); // 使用Getx方式关闭之前的所有页面
    }
  }
  // 检查用户是否登录
  checkIfAuthenticated(){
    return false;
  }
  // 获取用户 token
  getToken(){
    return 'your_token_here';
  }
}
```

## 接口统一管理

创建 api / user.dart  文件名根据项目和业务名称自定义

```dart
import '../utils/HttpsClient.dart';

class Test {
  late HttpsClient httpsClient;
  Test(){
    httpsClient = HttpsClient();
  }
  // 测试get接口
  httpGet([queryParameters]) async {
    var response = await httpsClient.get("api/httpGet",queryParameters);
    return response;
  }
}
```

使用

```dart
import 'package:get/get.dart';
import '/api/user.dart';

class LoginController extends GetxController {
    Test test = Test();
    login(){
        var response =await test.httpGet();
        print("登录接口测试");
        print(response);
    }
}
```

